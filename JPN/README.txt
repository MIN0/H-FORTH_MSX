−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
　　ＭＳＸ用ＦＯＲＴＨ系言語「Ｈ−ＦＯＲＴＨ」 Ver 1.4a

　　Copyright(c) 1999 A.Hiramatsu（平松　明夫） 99/05/29
−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−

●はじめに

　Ｈ−ＦＯＲＴＨとは、ＭＳＸ用にアレンジされた、ＦＯＲＴＨ系のプログラミング
言語です。この言語は、ＭＳＸのハードウエアに密着したプログラムを作るために作
った、いわば「マニア向け言語」です。

　対象ユーザーとしては、ＢＡＳＩＣをほぼマスターしていて、マシン語の知識も若
干持っている方を想定しています。Ｃ言語を使った経験があるならなお良いでしょう。

　「Ｈ−ＦＯＲＴＨ」は言語仕様の名称であり、Ｈ−ＦＯＲＴＨのソースプログラム
をＭＳＸのマシン語に変換するプログラムは「Ｈ−ＦＯＲＴＨコンパイラ」と言いま
す。

　Ｈ−ＦＯＲＴＨコンパイラはＭＳＸ−ＤＯＳ上で動作し、ＭＳＸ−ＤＯＳ用のマシ
ン語プログラム（ＣＯＭファイル）を出力します。


●コンパイラの動作環境

機種　　　　：	ＭＳＸ２、２＋、ｔｕｒｂｏＲ
メインＲＡＭ：	６４Ｋバイト以上
外部記憶装置：	少なくとも１台のフロッピーディスクドライブ
ＤＯＳ　　　：	ＭＳＸ−ＤＯＳ１またはＭＳＸ−ＤＯＳ２


●使い方

　まず、テキストエディタなどでソースプログラムを書きます。テキストエディタは
各自ご用意ください。ソースプログラムの名前に制限はありませんが、拡張子は .4TH
にすることをお薦めします。

　次に、ＤＯＳのコマンドラインから

	HFORTH 《ソースプログラムのファイル名》

でコンパイルを行います。ファイル名は拡張子まで指定してください。ＤＯＳ２の階
層ディレクトリには対応していないので、パスは指定できません。（ドライブ名は指
定できます。）

　コンパイルに成功すると、ＣＯＭファイルができあがります。ＣＯＭファイルの名
前はソースプログラムのファイル名の拡張子を .COM に変えたものになります。
（COMMAND.4TH なんて名前のソースをコンパイルすると泣きを見るので注意(^^;）

※ご使用の前に、すべてのドキュメント（README.DOC、UGUIDE1.DOC、UGUIDE2.DOC、
RGUIDE.DOC）をよくお読みください。


●このアーカイブ内のファイル内容

README.DOC	このファイルです。
HFORTH.COM	Ｈ−ＦＯＲＴＨコンパイラです。
HFORTH.MAC	Ｈ−ＦＯＲＴＨコンパイラのアセンブラソースです。
UGUIDE1.DOC	ユーザーズガイド１「導入編」です。
UGUIDE2.DOC	ユーザーズガイド２「中級編」です。
RGUIDE.DOC	リファレンスガイドです。

（UGUIDE1.DOC、UGUIDE2.DOC、RGUIDE.DOC は、内容的に Ver1.4 から変更がないので
 Ver1.4 のものをそのまま添付しています。）

●著作権等について

　Ｈ−ＦＯＲＴＨコンパイラおよび付随するドキュメントはフリーソフトウエアです。
配布は自由ですが、著作権は放棄していません。

　Ｈ−ＦＯＲＴＨコンパイラおよび付随するドキュメントの著作権は私 A.Hiramatsu
（平松　明夫）が所持しています。また、Ｈ−ＦＯＲＴＨコンパイラが作成したＣＯ
Ｍファイルの中にはＨ−ＦＯＲＴＨランタイムルーチンが含まれていますが、このラ
ンタイムルーチンの著作権も私が所持しています。

　Ｈ−ＦＯＲＴＨコンパイラ及び付随するドキュメントを配布する際には、以下の点
を必ず守ってください。

　　・ファイル内容を改変しない。
　　・アーカイブ内のファイルをすべていっしょに配布する。
　　・ソフトウエア自体は無料であり、代金を請求してはならない。配布の際にブラ
　　　ンクディスク代、送料、通信回線使用料などの費用がかかった場合、その実費
　　　以上の金額を請求してはならない。

　Ｈ−ＦＯＲＴＨコンパイラが作成したＣＯＭファイルは、フリーソフトウエアにす
るか有料で販売するかは任意です。ただし、以下の点を必ず守ってください。

　　・Ｈ−ＦＯＲＴＨコンパイラで作成した物であることを明記すること。
　　・Ｈ−ＦＯＲＴＨの著作者が私 A.Hiramatsu（平松　明夫） であることを明記
　　　すること。

　Ｈ−ＦＯＲＴＨコンパイラ、及びコンパイラが作成したＣＯＭファイルを使用した
ことにより発生した損害については、私 A.Hiramatsu（平松　明夫）はいかなる場合
においても責任を負いません。

●コンパイラのソース（HFORTH.MAC）について

　コンパイラのアセンブラソースを添付しているのは、コンパイラやランタイムルー
チンの仕組みを理解してもらうためです。

　もともと人に見せるつもりで書いたわけではないのでかなり読みにくいかもしれま
せん。たとえばラベル名の付けかたなども、何年にもわたって開発しているせいで一
貫性がありません。

　それでも、「コンパイラの出したＣＯＭファイルの挙動がどうも納得いかない。中
身はどうなっているんだ」という方には、多少の助けになるかと思います。

　なお、私は基本的には、コンパイラの改造を認めておりません。ソースを添付して
いるのは改造してもらうためではありません。

　私が最も危惧しているのは、各自が思い思いに改造した、仕様の異なるコンパイラ
が氾濫し、「このソースは誰々版のコンパイラじゃないと通らない」とかいった事態
が起こることです。

　どうしても改造したい、改造版コンパイラを世間に発表したい、という方はとにか
く私 A.Hiramatsu（平松　明夫）までメールにてご相談ください。

　少なくとも、「画面モード切り替えのワードを付けました」「ＰＳＧアクセス用の
ワードを付けました」といったレベルの改造はして欲しくないです。そんな程度なら
コンパイラを改造するまでもないですから。


●改版歴

96/04/06  Ver1.0	初版
96/06/23  Ver1.1	可変配列に対し & を使った時に起こるバグを修正
			JSR の仕様を変更
97/03/04  Ver1.2	CNVFCB のバグ修正
			DATA( ) 中に & が使えるようにした
			最適化強化
			・BCレジスタ利用率ＵＰ
			・小さな定数の加減算で INC/DEC命令を使う
			・制御構文でムダなジャンプ命令をできるだけ出さない
98/01/28  Ver1.3	EXTVAR( ) による外部変数を導入
			DATA( ) 中に文字列を使用できるようにした
			最適化強化
			・バイト型変数のアクセス最適化を強化
			・文字列、定数データ列をルーチン外に出す
			　（従来はJP命令でそれらをスキップしていたのをJP命令
			　　不要にした）
99/04/01  Ver1.4	スタックアクセス最適化のバグ修正
			ワード IF{ の最適化強化
99/05/29  Ver1.4a	スタックに値を残したまま IF{ 構文を閉じた場合に起こる
			バグを修正

●連絡先

　Ｈ−ＦＯＲＴＨについて、ご意見、感想、バグ報告などございましたら、以下へご
連絡ください。

・インターネットＥ−ｍａｉｌ

	hiramatu@ca.mbn.or.jp

　なお、私のホームページ

	http://plaza9.mbn.or.jp/~a_hiramatsu

にて、Ｈ−ＦＯＲＴＨに関する情報提供を行いますので、ぜひご覧ください。

●Special thanks

　鈴見咲君高さん、バグ報告ありがとうございました。

